# 22장. this

### this의 필요성

- 객체는 프로퍼티(상태)와 메서드(동작)를 하나의 논리적인 단위로 묶은 복합 자료구조
- 메서드는 자신이 속한 프로퍼티(상태)를 참조하고 변경할 수 있어야 함
← 자신이 속한 객체를 가리키는 식별자를 참조할 수 있어야 함
- 자기 자신이 속한 객체를 재귀적으로 참조하는 방식은 바람직하지 않다.
    - 생성자 함수 방식으로 인스턴스 생성 시 먼저 생성자 함수가 존재해야 함
    - 생성자 함수 정의 시점 = 생성자 함수가 생성할 인스턴스를 가리키는 식별자 알 수 없음
    
    ⇒ 자신이 속한 객체나 생성할 인스턴스를 가리키는 특수한 식별자가 필요함
    

### this란?

- 자신이 속한 객체 또는 자신이 생성할 인스턴스를 가리키는 자기 참조 변수
함수 내에서 함수 호출 맥락을 의미 (맥락이기에 함수 호출 상황에 따라 this 대상이 달라짐)
함수와 객체의 관계가 느슨한 자바스크립트에서 this는 이 둘을 연결시켜주는 실질적인 연결점
- 키워드로 분류되지만 식별자의 역할을 함
- 자바스크립트 엔진에 의해 암묵적으로 생성
(함수 호출 시 arguments 객체와 this가 암묵적으로 전달 → 지역변수처럼 사용 가능)
- 코드 어디서든(전역에서든, 함수 내부에서든) 참조할 수 있음
하지만 일반적으로 객체의 메서드 내부 또는 생성자 함수 내부에서만 의미를 가짐
    
    strict mode 적용된 일반 함수 내부에서의 this = undefined가 바인딩
    
- this는 상황에 따라 가리키는 대상이 다름
(다른 클래스 기반 언어와 달리 함수 호출 방식에 따라 this 바인딩이 동적으로 결정)

### this의 바인딩

- this의 바인딩
    
    = 함수 호출 상황에 따라 this의 객체가 동적으로 결정되는 것
    
    - JS 엔진은 해당 프로그램을 실행하면
    모든 실행 가능한 코드(전역 코드, 함수 코드, eval 코드 등)를 평가 후
    실행 문맥(실행에 필요한 렉시컬 환경 컴포넌트, **this 바인딩 컴포넌트** 등으로 구성) 생성
    - 전역 실행 문맥 생성
    → 함수 호출 시 전역 실행 문맥 중단, 함수 실행 문맥 생성 & this 바인딩 컴포넌트 값 결정
- this가 상황에 따라 동적으로 바인딩되는 이유
    - 자바스크립트의 함수는 객체, 그 중 일급 객체 → 다양한 환경에서 호출 가능
    (자기 자신이라는 상황이 모호하게 느껴짐)
        1. 변수나 데이터에 저장 가능
        2. 다른 함수의 인수로 전달 가능
        3. 다른 함수의 반환값으로 사용 가능
    - JS 함수의 호출 상황
        1. 단독 호출
        2. 특정 객체의 메서드로 호출
        3. 동일한 함수가 다른 객체에 의해서 호출되기도
    
    ⇒ 함수 선언 이후 어떤 객체에 의해 호출될지 예측할 수 없음 (실행 환경에 따라 달라짐)
    

### this의 바인딩 규칙

this는 함수가 호출되는 상황에 따라 기본적으로 네가지 규칙에 의해 바인딩되며 우선순위가 존재함
(기본 바인딩, 암시적 바인딩, new 바인딩, 명시적 바인딩)

1. 기본 바인딩 (함수 단독 실행)
    1. 비엄격 모드 (일반적 상황) = 전역 객체
    (브라우저 실행 환경에서는 윈도우 객체 / 노드 환경에서는 두가지 방향으로 바인딩된다)
    2. use strict 사용한 엄격 모드 = undefined
    (전역 객체가 바인딩 대상에서 제외 → 바인딩할 객체가 존재하지 않기 때문)
    - 객체를 생성하지 않는 일반 함수에서는 this의 의미가 없으며,
    메서드 내 정의된 중첩 함수, 콜백함수 상관없이 일반함수로 호출될 경우 기본 바인딩된다
    - 메서드 내부의 중첩 함수나 콜백함수의 this를 메서드의 this 바인딩으로 일치시키기 위해서는 this 바인딩을 변수에 할당한 후 콜백 함수 내부에서 해당 변수를 참조하거나 명시적 바인딩 사용한다.
2. 암시적 바인딩 (객체의 메서드로 호출되는 경우) = 점 바로 앞에 있는 객체에 바인딩
    1. 객체 리터럴 메서드 내부에서의 this = 메서드를 호출한 객체를 지칭(바인딩)
    2. 생성자 함수 내부의 this = 생성자 함수가 생성할 인스턴스를 지칭(바인딩)
    - 주의 사항
        
        점연산, 인수로 전달된 콜백함수 참조 등에서는 undefined 반환 (바인딩된 this를 잃어버림)
        
        이유 >
        점연산 또는 대괄호연산으로 객체 프로퍼티에 접근할 경우 참조 타입의 값을 반환함
        하지만 그 이외의 연산은 참조타입이 아닌 프로퍼티의 값만 전달
        다른 변수 할당하는 순간 참조값만 남기에 바로 호출 이외에는 암시적 바인딩 기대 X
        
        - 참조 타입 = 프로퍼티/ 프로퍼티 객체 / strict 모드 확인 가능한 일종의 타입
3. 명시적 바인딩 = call, apply, bind 등의 메서드 활용
    - call과 apply = 첫 인자로 this 바인딩할 객체, 이후에 인수를 넣어줌
    (call은 인수를 하나하나씩, apply는 인수를 배열 또는 유사배열 형태로 전달)
    - bind = 첫 인자로 this 바인딩할 객체, 이후 인수로 사용될 값 입력
    항상 같은 객체에 바인딩하도록 함 (하드 바인딩이라고도 부름)
4. new 바인딩 = new 연산자를 이용한 호출
    
    생성자 함수로서의 역할을 수행
    
- 바인딩 규칙의 우선순위는 다음과 같음
new 바인딩 > 암시적 바인딩 > 명시적 바인딩 > 기본 바인딩 (전역 객체, undefined)
- 화살표 함수와 this 바인딩
    - 화살표 함수는 여러 부분에 있어서 일반 함수와 다른데 this의 경우도 일반 함수와 다름
    - 화살표 함수의 목적 중 하나는 상위 실행 문맥을 유지하는 것, 따라서 화살표 함수 안에서의 this는 상위 스코프에 해당하는 this 바인딩 컴포넌트를 참조함
        
        ⇒ 어휘적 this, 렉시컬 this라고도 함
        

### 참고자료

- 책 ‘모던 자바스크립트 DeepDive’ chapter 22. this
- 유튜브 우아한테크 - ‘[10분 테코톡] 브콜의 this’
- 유튜브 생활코딩 - ‘Javascript - this(1/5) : 함수와 this’